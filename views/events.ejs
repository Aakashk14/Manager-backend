<html>
    <head>       
         <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <link href='/fullcalendar/main.css' rel='stylesheet' />
        <script src="/fullcalendar/main.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <link href="/sidebar.css" rel="stylesheet">



        <Style>
              body{
                margin: 0;
                overflow: hidden;
            }
            
             
            .header{
                position: sticky;
                height: 50px;
                background-color: rgb(233, 233, 233);
            }
            .header p{
                cursor: pointer;
            }
            .header #static,#list{
                display: inline-block;
                position: relative;
                margin: 10px;
                bottom:4px;
                border: 2px solid;
                border-radius: 4px;
                font-family: Verdana, Geneva, Tahoma, sans-serif;
                background-color: rgb(197, 211, 211);
            }
            /* .sidebar{
                background-color: rgb(7, 7, 19);
                width: 200px;
                height: 715px;
                position: relative;
                bottom:1px;
                margin:0;
            } */
            .fc-day-today {
  background-color: inherit !important;
}
.fc-event{
    cursor: pointer;
}
          /* .sidebar p{
                display: block;
                cursor: pointer;
                background-color: rgb(217, 220, 207);
                padding: 10px;
                position: relative;
                top:200px;
                font-family: Verdana, Geneva, Tahoma, sans-serif;
            } 
            .sidebar p[active=true]{
                background-color: rgb(9, 64, 214);
            }   */
            .container{ 
              background-color: red;
            }
            .title p{
                font-family: Verdana, Geneva, Tahoma, sans-serif;
            }
            .details{
                height: 300px;
                width: 400px;
                border: 1px solid ;
                
            }
            .comments{
                width: 400px;
                height: 500px;
                position: absolute;
               left:60%;
               top:15%;
               border: 10px solid rgb(70, 68, 68);
            }
            #top{
                border-bottom:2px solid;
                background-color: rgb(110, 107, 107);
            }
            .action{
                position: relative;
                left:70%;
                bottom:90%;
            }
            .action input[type=button]{
                width: 100px;
                height: 40px;
                background-color: white;
            }
         .events{
             position: absolute;
             top:100px;
             left:230px;
             width: 1000px;
             height: 800px;

         }
       
         .funcs{
             position: absolute;
             left:84%;
             top:100px;
             width: 200px;
             height: 140px;
         }
         #even{
             position: relative;
             top:60px;
             right:0px;
         }
         #note{
             position: relative;
             left:200px;
             text-decoration: underline;
         }
            
         .view{
             z-index: 2;
             background-color: white;
             position: absolute;
             left:400px;
             top:200px;
             height: 350px;
             width: 600px;
             box-shadow: 0 3px 10px rgb(0 0 0 / 0.2);

             
         }
        .del{
            position: absolute;
            right:2px;
            width: 70px;
        }
           .view .members{
               height: 200px;
               overflow: auto;
               width: 300px;
           }

           .close{
               position: absolute;
               right:1px;
               background-color: red;
               top:50px;
               width: 70px;
               
           }
           #frame1{
               position: relative;
               right:128px;
               width: 100%;
               height: 100%;
               bottom:40px;
           }
           .new_event{
               width: 700px;
               height: 600px;
               z-index: 2;
               position: absolute;
               left:300px;
               top:150px;
           }
           .new_event .form{
                margin: 10px;
                background-color: rgb(154, 168, 193);
                position:absolute;
                top:25px;
                box-shadow: 0 3px 10px rgb(0 0 0 / 0.2);
                width: 70%;

               
            }
            .form input[type=text],textarea{
                
                display: inline-block;
                margin: 10px;
                resize: none;
                outline: none;
                border-radius: 4px;
            }
            .fc-day:hover{background:lightblue;cursor: pointer;}

            .form input[type=text],select,input[type=file]{
                width: 450px;
                height: 40px;
                position: relative;
                left:1px;
                border-radius: 4px;
            }
            .form input[type=file],select,input[type=submit]{
                position: relative;
                left:100px;
                outline: none;
                margin: 4px;
                border-radius: 4px;

            }
            input[type=submit]{
                width: 200px;
                height: 50px;
                position: relative;
                left:14%;
                margin: 20px;
                font-family: Verdana, Geneva, Tahoma, sans-serif;
            }
            .dates{
                position: relative;
                left:20px;
            }
            #btn{
                position: relative;
                top:4px;
                left:10px;
                background-color: red;
            }
          
            #title{
                font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
                margin-left: 10px;
                font-size: 20px;
                text-decoration: underline;
            }
            .members{
                margin-left: 10px;
            }
            .event_d h6{
                margin-left: 10px;
            }
        </Style>
    </head>
    <script type="text/javascript">
          document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth',
          height:590,
          dateClick:function(dateClickInfo){

             document.getElementById("starting").value=dateClickInfo.dateStr
             // $("#starting").val(dateClickInfo.datestr)
              $(".new_event").show()
          },
          eventClick: function(info) {
$.get(`/events/members?id=${info.event.id}`,function(response){
   
    let el = document.createElement("p");
    el.innerText=info.event.title;
    el.id="title"
    $(".event_d").prepend(el);
    $(".view button").attr('id',info.event.id)
let external = JSON.parse(response.external)
   for(x of external.members){
       let el1 = document.createElement("p");
       el1.innerText=x.email;
       $(".view .members").append(el1)
   }
if(response.users){
   for(x of response.users){
    let el1 = document.createElement("p");
       el1.innerText=x.email;
       $(".view .members").append(el1)
   }
}
   $(".view").show()

    // change the border color just for fun
    info.el.style.borderColor = 'red';

  })
}
        });
        calendar.render();
        var x ='<%- JSON.stringify(data) %>'
        var data = JSON.parse(x)
        if(data!=0){
        for(x of data){
        var date = new Date(x.starting_date)

        calendar.addEvent({
            title: x.Name,
              start: date,
              allDay: true,
              id:x.eventsId
            });
        }
    }
        
      });

$(()=>{
    $(".event_d button").on("click",function(){
        id=$(this).attr('id')
        $.ajax({
            url:"/event/delete",
            method:"post",
            data:{id:id},
            success:function(response){
                if(response!="error"){
                    location.reload()
                }else{
                    alert("error");
                    $(".view").hide()
                }
            }
        })

    })
    $(".close_dialog button").on("click",()=>{
        $(".view").hide()
    })
    $(".new_event button").on('click',function(){
        $(".new_event").hide()
        $("#details").val('')
        $("#title").val('')
    })
})
      </script>
    <body>
        <div class="header">
            <p id="static" onclick="location.href='/home'">Home</p>

            <p id="static" onclick="location.href='/my/profile'">My Profile</p>
            <p id="static" onclick="location.href='/logout'">Logout</p>
            <p id="list" onclick="location.href='/chat/'">Chat</p>

            <% if(level==1) {%>
                <p id="static" onclick="location.href='/settings'">Settings</p>
            <%}%>
           

        </div>
       
        <div class="new_event" style="display: none;">
            <button type="button" id="btn" class="btn btn-sm btn-danger">Close</button>
            <div class="form">
              <form method="post" action="/events/create">
            <input type="text" id="title" name="name" placeholder="Title">
            <textarea cols="59" id="details" rows="10" name="details"></textarea>
            <input type="hidden" value="<%=token %>" name="token">
            <div class="dates">
           <label for="starting">Starting Date:</label> <input type="date" id="starting" name="start_date">
           </div>


            
            <input type="text" name="emails"placeholder="email1,email2">
            <input type="submit" value="Create Event">
            </form>

        </div>
        </div>

        
        <div class="sidebar">
            <p onclick="location.href='/tasks'">Tasks</p>
            <p active="true" onclick="location.href='/events'">Events</p>
        
        </div>
        <div class="funcs">
            <button type="button" class="btn btn-secondary" onclick="location.href='/events/new'">Add Event</button>
           <!-- experimental-->
            <!-- <button id="even" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">External Url</button>-->
        </div> 
        <div class="view" style="display: none;">
            <div class="close_dialog">
            <button type="button" id="close" type="button" class=" close btn btn-sm btn-danger">Close</button>
            <button type="button" id="del_e" class="del btn btn-sm btn-primary">Delete</button>

            </div>

            <div class="event_d">
            
            <h6>Members</h6>
            <div class="members border">
                

            </div>
            
            
            </div>
        </div>
       
       <div class="events">
           <p id="note">You can also add event by clicking on date</p>
        <div id='calendar'></div>
</div>

            
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">one time url to add events in your calender </h5>
  
          
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <h6>let others Schedule events to your calender</h6>
            
            <button type="button" class="btn btn-sm btn-primary">Generate Unique url</button>
            

            <div class=" container border">
                
            
            </div>



        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>


        </body>
        </html>
     